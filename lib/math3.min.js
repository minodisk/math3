(function(){function t(i,s,h){var m;if(!(this instanceof t)){if(v(i))return new t(i[0],i[1],i[2]);throw new TypeError("TypeError: Type Coercion failed: cannot convert "+i+" to Vector")}i instanceof t&&(m=i,i=m.x,s=m.y,h=m.z),this.x=null!=i?i:0,this.y=null!=s?s:0,this.z=null!=h?h:0}function i(t,i,s){this.heading=null!=t?t:0,this.pitch=null!=i?i:0,this.bank=null!=s?s:0}function s(t,i,s,h){this.w=null!=t?t:1,this.x=null!=i?i:0,this.y=null!=s?s:0,this.z=null!=h?h:0}function h(t,i,s,h,m,n,o,e,r){this.m11=t,this.m12=i,this.m13=s,this.m21=h,this.m22=m,this.m23=n,this.m31=o,this.m32=e,this.m33=r}function m(t,i,s,h,n,o,e,r,y,a,u,c){if(t instanceof m){var p=t;t=p.m11,i=p.m12,s=p.m13,h=p.m21,n=p.m22,o=p.m23,e=p.m31,r=p.m32,y=p.m33,a=p.tx,u=p.ty,c=p.tz}this.m11=null!=t?t:1,this.m12=null!=i?i:0,this.m13=null!=s?s:0,this.m21=null!=h?h:0,this.m22=null!=n?n:1,this.m23=null!=o?o:0,this.m31=null!=e?e:0,this.m32=null!=r?r:0,this.m33=null!=y?y:1,this.tx=null!=a?a:0,this.ty=null!=u?u:0,this.tz=null!=c?c:0}var n=this.Math,o=n.PI,e=2*o,r=o/2,y=1/r,a=n.sin,u=n.cos,c=(n.tan,n.asin),p=n.acos,z=(n.atan,n.atan2),x=n.sqrt,f=n.abs,l=n.floor,w=(n.ceil,function(t){return t+=o,t-=l(t*y)*e,t-=o}),d=function(t){return-1>=t?o:t>=1?0:p(t)},b=(this.parseFloat,Object.prototype.toString),v=Array.isArray||function(t){return"[object Array]"===b.call(t)};t.kZeroVector=new t(0,0,0),t.kRightVector=new t(1,0,0),t.kUpVector=new t(0,1,0),t.kForwardVector=new t(0,0,1),t.crossProduct=function(t,i){return t.crossProduct(i)},t.dotProduct=function(t,i){return t.dotProduct(i)},t.distance=function(t,i){return t.distance(i)},t.distanceSquared=function(t,i){return t.distanceSquared(i)},t.isUnit=function(i){return f(t.dotProduct(i,i)-1)>.01},t.prototype.assign=function(t){this.x=t.x,this.y=t.y,this.z=t.z},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},t.prototype.notEquals=function(t){return this.x!==t.x||this.y!==t.y||this.z!==t.z},t.prototype.zero=function(){this.x=this.y=this.z=0},t.prototype.minus=function(){return t(-this.x,-this.y,-this.z)},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z)},t.prototype.multiply=function(i){return new t(this.x*i,this.y*i,this.z*i)},t.prototype.divide=function(i){var s=1/i;return new t(this.x*s,this.y*s,this.z*s)},t.prototype.set=function(i,s,h){if(i instanceof t){var m=i;i=m.x,s=m.y,h=m.z}return this.x=i,this.y=s,this.z=h,this},t.prototype.normalize=function(){var t,i=this.x*this.x+this.y*this.y+this.z*this.z;i>0&&(t=1/x(i),this.x*=t,this.y*=t,this.z*=t)},t.prototype.magnitude=function(){return x(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.crossProduct=function(i){return t(this.y*i.z-this.z*i.y,this.z*i.x-this.x*i.z,this.x*i.y-this.y*i.x)},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.distance=function(t){var i=this.x-t.x,s=this.y-t.y,h=this.z-t.z;return x(i*i+s*s+h*h)},t.prototype.distanceSquared=function(t){var i=this.x-t.x,s=this.y-t.y,h=this.z-t.z;return i*i+s*s+h*h},i.kEulerAnglesIdentity=new i(0,0,0),i.prototype.identity=function(){this.heading=this.pitch=this.bank=0},i.prototype.set=function(t,s,h){if(t instanceof i){var m=t;t=m.heading,s=m.pitch,h=m.bank}return this.heading=t,this.pitch=s,this.bank=h,this},i.prototype.canonize=function(){this.pitch=w(this.pitch),-r>this.pitch?(this.pitch=-o-this.pitch,this.heading+=o,this.bank+=o):this.pitch>r&&(this.pitch=o-this.pitch,this.heading+=o,this.bank+=o),f(this.pitch)>r-1e-4?(this.heading+=this.bank,this.bank=0):this.bank=w(this.bank),this.heading=w(this.heading)},i.prototype.fromObjectToInertialQuaternion=function(t){var i=-2*(t.y*t.z-t.w*t.x);f(i)>.9999?(this.pitch=r*i,this.heading=z(-t.x*t.z+t.w*t.y,.5-t.y*t.y-t.z*t.z),this.bank=0):(this.pitch=c(i),this.heading=z(t.x*t.z+t.w*t.y,.5-t.x*t.x-t.y*t.y),this.bank=z(t.x*t.y+t.w*t.z,.5-t.x*t.x-t.z*t.z))},i.prototype.fromInertialToObjectQuaternion=function(t){var i=-2*(t.y*t.z+t.w*t.x);f(i)>.9999?(this.pitch=r*i,this.heading=z(-t.x*t.z-t.w*t.y,.5-t.y*t.y-t.z*t.z),this.bank=0):(this.pitch=c(i),this.heading=z(t.x*t.z-t.w*t.y,.5-t.x*t.x-t.y*t.y),this.bank=z(t.x*t.y-t.w*t.z,.5-t.x*t.x-t.z*t.z))},i.prototype.fromObjectToWorldMatrix=function(t){var i=-t.m32;f(i)>9.99999?(this.pitch=r*i,this.heading=z(-t.m23,t.m11),this.bank=0):(this.heading=z(t.m31,t.m33),this.pitch=c(i),this.bank=z(t.m12,t.m22))},i.prototype.fromWorldToObjectMatrix=function(t){var i=-t.m23;f(i)>9.99999?(this.pitch=r*i,this.heading=z(-t.m31,t.m11),this.bank=0):(this.heading=z(t.m13,t.m33),this.pitch=c(i),this.bank=z(t.m21,t.m22))},i.prototype.fromRotationMatrix=function(t){var i=-t.m32;f(i)>9.99999?(this.pitch=r*i,this.heading=z(-t.m13,t.m11),this.bank=0):(this.heading=z(t.m31,t.m33),this.pitch=c(i),this.bank=z(t.m12,t.m22))},i.prototype.add=function(t){return new i(this.heading+t.heading,this.pitch+t.pitch,this.bank+t.bank)},i.prototype.subtract=function(t){return new i(this.heading-t.heading,this.pitch-t.pitch,this.bank-t.bank)},i.prototype.multiply=function(t){return new i(this.heading*t,this.pitch*t,this.bank*t)},i.prototype.divide=function(t){return new i(this.heading/t,this.pitch/t,this.bank/t)},s.prototype.identity=function(){this.w=1,this.x=this.y=this.z=0},s.dotProduct=function(t,i){return t.dotProduct(i)},s.crossProduct=function(t,i){return t.crossProduct(i)},s.conjugate=function(t){return t.conjugate()},s.pow=function(t,i){return t.pow(i)},s.kQuaternionIdentity=new s(1,0,0,0),s.prototype.setToRotateAboutX=function(t){var i=.5*t;this.w=u(i),this.x=a(i),this.y=0,this.z=0},s.prototype.setToRotateAboutY=function(t){var i=.5*t;this.w=u(i),this.x=0,this.y=a(i),this.z=0},s.prototype.setToRotateAboutZ=function(t){var i=.5*t;this.w=u(i),this.x=0,this.y=0,this.z=a(i)},s.prototype.setToRotateAboutAxis=function(t,i){if(!(.01>f(t.magnitude()-1)))throw new TypeError("The axis of rotation must be normalized");var s=.5*i,h=a(s);this.w=u(s),this.x=t.x*h,this.y=t.y*h,this.z=t.z*h},s.prototype.setToRotateObjectToInertial=function(t){var i=.5*t.heading,s=.5*t.pitch,h=.5*t.bank,m=a(i),n=a(s),o=a(h),e=u(i),r=u(s),y=u(h);this.w=e*r*y+m*n*o,this.x=e*n*y+m*r*o,this.y=-e*n*o+m*r*y,this.z=-m*n*y+e*r*o},s.prototype.setToRotateInertialToObject=function(t){var i=.5*t.heading,s=.5*t.pitch,h=.5*t.bank,m=a(i),n=a(s),o=a(h),e=u(i),r=u(s),y=u(h);this.w=e*r*y+m*n*o,this.x=-e*n*y-m*r*o,this.y=e*n*o-m*y*r,this.z=m*n*y-e*r*o},s.prototype.normalize=function(){var t=x(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);if(t>0){var i=1/t;this.w*=i,this.x*=i,this.y*=i,this.z*=i}else this.identity()},s.prototype.getRotationAngle=function(){var t=d(this.w);return 2*t},s.prototype.getRotationAxis=function(){var i=1-this.w*this.w;if(0>=i)return new t(1,0,0);var s=1/x(i);return new t(this.x*s,this.y*s,this.z*s)},s.prototype.dotProduct=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},s.prototype.crossProduct=function(t){var i=new s;return i.w=this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z,i.x=this.w*t.x+this.x*t.w+this.z*t.y-this.y*t.z,i.y=this.w*t.y+this.y*t.w+this.x*t.z-this.z*t.x,i.z=this.w*t.z+this.z*t.w+this.y*t.x-this.x*t.y,i},s.slerp=function(t,i,h){if(0>=h)return t;if(h>=1)return i;var m=s.prototype.dotProduct(t,i),n=i.w,o=i.x,e=i.y,r=i.z;if(0>m&&(n=-n,o=-o,e=-e,r=-r,m=-m),!(1.1>m))throw new TypeError("We should have two unit quaternions, so dot should be <= 1.0");var y,u;if(m>.9999)y=1-h,u=h;else{var c=x(1-m*m),p=z(c,m),f=1/c;y=a((1-h)*p)*f,u=a(h*p)*f}var l=new s;return l.x=y*t.x+u*o,l.y=y*t.y+u*e,l.z=y*t.z+u*r,l.w=y*t.w+u*n,l},s.prototype.conjugate=function(){var t=new s;return t.w=this.w,t.x=-this.x,t.y=-this.y,t.z=-this.z,t},s.prototype.pow=function(t){if(f(this.w)>.9999)return this;var i=p(this.w),h=i*t,m=new s;m.w=u(h);var n=a(h)/a(i);return m.x=this.x*n,m.y=this.y*n,m.z=this.z*n,m},h.prototype.identity=function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1},h.prototype.setup=function(t){var i=a(t.heading),s=a(t.pitch),h=a(t.bank),m=u(t.heading),n=u(t.pitch),o=u(t.bank);this.m11=m*o+i*s*h,this.m12=-m*h+i*s*o,this.m13=i*n,this.m21=h*n,this.m22=o*n,this.m23=-s,this.m31=-i*o+m*s*h,this.m32=h*i+m*s*o,this.m33=m*n},h.prototype.fromInertialToObjectQuaternion=function(t){this.m11=1-2*(t.y*t.y+t.z*t.z),this.m12=2*(t.x*t.y+t.w*t.z),this.m13=2*(t.x*t.z-t.w*t.y),this.m21=2*(t.x*t.y-t.w*t.z),this.m22=1-2*(t.x*t.x+t.z*t.z),this.m23=2*(t.y*t.z+t.w*t.x),this.m31=2*(t.x*t.z+t.w*t.y),this.m32=2*(t.y*t.z-t.w*t.x),this.m33=1-2*(t.x*t.x+t.y*t.y)},h.prototype.fromObjectToInertialQuaternion=function(t){this.m11=1-2*(t.y*t.y+t.z*t.z),this.m12=2*(t.x*t.y-t.w*t.z),this.m13=2*(t.x*t.z+t.w*t.y),this.m21=2*(t.x*t.y+t.w*t.z),this.m22=1-2*(t.x*t.x+t.z*t.z),this.m23=2*(t.y*t.z-t.w*t.x),this.m31=2*(t.x*t.z-t.w*t.y),this.m32=2*(t.y*t.z+t.w*t.x),this.m33=1-2*(t.x*t.x+t.y*t.y)},h.prototype.inertialToObject=function(i){return new t(this.m11*i.x+this.m21*i.y+this.m31*i.z,this.m12*i.x+this.m22*i.y+this.m32*i.z,this.m13*i.x+this.m23*i.y+this.m33*i.z)},h.prototype.objectToInertial=function(i){return new t(this.m11*i.x+this.m12*i.y+this.m13*i.z,this.m21*i.x+this.m22*i.y+this.m23*i.z,this.m31*i.x+this.m32*i.y+this.m33*i.z)},m.prototype.identity=function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=this.ty=this.tz=0},m.prototype.zeroTranslation=function(){this.tx=this.ty=this.tz=0},m.prototype.setTranslation=function(t){this.tx=t.x,this.ty=t.y,this.tz=t.z},m.prototype.setupTranslation=function(t){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=t.x,this.ty=t.y,this.tz=t.z},m.prototype.setupLocalToParent=function(t,i){var s=new h;s.setup(i),this.setupLocalToParent(t,s)},m.prototype.setupLocalToParent=function(t,i){this.m11=i.m11,this.m12=i.m21,this.m13=i.m31,this.m21=i.m12,this.m22=i.m22,this.m23=i.m32,this.m31=i.m13,this.m32=i.m23,this.m33=i.m33,this.tx=t.x,this.ty=t.y,this.tz=t.z},m.prototype.setupParentToLocal=function(t,i){var s=new h;s.setup(i),this.setupParentToLocal(t,s)},m.prototype.setupParentToLocal=function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.tx=-(t.x*this.m11+t.y*this.m21+t.z*this.m31),this.ty=-(t.x*this.m12+t.y*this.m22+t.z*this.m32),this.tz=-(t.x*this.m13+t.y*this.m23+t.z*this.m33)},m.prototype.setupRotateX=function(t){var i=a(t),s=u(t);this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=s,this.m23=i,this.m31=0,this.m32=-i,this.m33=s,this.tx=this.ty=this.tz=0},m.prototype.setupRotateY=function(t){var i=a(t),s=u(t);this.m11=s,this.m12=0,this.m13=-i,this.m21=0,this.m22=1,this.m23=0,this.m31=i,this.m32=0,this.m33=s,this.tx=this.ty=this.tz=0},m.prototype.setupRotateZ=function(t){var i=a(t),s=u(t);this.m11=s,this.m12=i,this.m13=0,this.m21=-i,this.m22=s,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=this.ty=this.tz=0},m.prototype.setupRotate=function(t,i){assert(1>f(t*t-1));var s=a(i),h=u(i),m=1-h,n=m*t.x,o=m*t.y,e=m*t.z;this.m11=n*t.x+h,this.m12=n*t.y+t.z*s,this.m13=n*t.z-t.y*s,this.m21=o*t.x-t.z*s,this.m22=o*t.y+h,this.m23=o*t.z+t.x*s,this.m31=e*t.x+t.y*s,this.m32=e*t.y-t.x*s,this.m33=e*t.z+h,this.tx=this.ty=this.tz=0},m.prototype.fromQuaternion=function(t){var i=2*t.w,s=2*t.x,h=2*t.y,m=2*t.z;this.m11=1-h*t.y-m*t.z,this.m12=s*t.y+i*t.z,this.m13=s*t.z-i*t.x,this.m21=s*t.y-i*t.z,this.m22=1-s*t.x-m*t.z,this.m23=h*t.z+i*t.x,this.m31=s*t.z+i*t.y,this.m32=h*t.z-i*t.x,this.m33=1-s*t.x-h*t.y,this.tx=this.ty=this.tz=0},m.prototype.setupScale=function(t){this.m11=t.x,this.m12=0,this.m13=0,this.m21=0,this.m22=t.y,this.m23=0,this.m31=0,this.m32=0,this.m33=t.z,this.tx=this.ty=this.tz=0},m.prototype.setupScaleAlongAxis=function(t,i){assert(1>f(t*t-1));var s=i-1,h=s*t.x,m=s*t.y,n=s*t.z;this.m11=h*t.x+1,this.m22=m*t.y+1,this.m32=n*t.z+1,this.m12=this.m21=h*t.y,this.m13=this.m31=h*t.z,this.m23=this.m32=m*t.z,this.tx=this.ty=this.tz=0},m.prototype.setupShear=function(t,i,s){switch(t){case 1:this.m11=1,this.m12=i,this.m13=s,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1;break;case 2:this.m11=1,this.m12=0,this.m13=0,this.m21=i,this.m22=1,this.m23=s,this.m31=0,this.m32=0,this.m33=1;break;case 3:this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=i,this.m32=s,this.m33=1;break;default:assert(!1)}this.tx=this.ty=this.tz=0},m.prototype.setupProject=function(t){assert(1>f(t*t-1)),this.m11=1-t.x*t.x,this.m22=1-t.y*t.y,this.m33=1-t.z*t.z,this.m12=this.m21=-t.x*t.y,this.m13=this.m31=-t.x*t.z,this.m23=this.m32=-t.y*t.z,this.tx=this.ty=this.tz=0},m.prototype.setupReflect=function(t,i){switch(null==i&&(i=0),t){case 1:this.m11=-1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=2*i,this.ty=0,this.tz=0;break;case 2:this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=-1,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=0,this.ty=2*i,this.tz=0;break;case 3:this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=-1,this.tx=0,this.ty=0,this.tz=2*i;break;default:assert(!1)}},m.prototype.setupReflect=function(t){assert(1>f(t*t-1));var i=-2*t.x,s=-2*t.y,h=-2*t.z;this.m11=1+i*t.x,this.m22=1+s*t.y,this.m32=1+h*t.z,this.m12=this.m21=i*t.y,this.m13=this.m31=i*t.z,this.m23=this.m32=s*t.z,this.tx=this.ty=this.tz=0},m.prototype.setupReflect=function(t){this.m11=-2*t.a*t.a+1,this.m12=-2*t.b*t.a,this.m13=-2*t.c*t.a,this.m21=-2*t.a*t.b,this.m22=-2*t.b*t.b+1,this.m23=-2*t.c*t.b,this.m31=-2*t.a*t.c,this.m32=-2*t.b*t.c,this.m33=-2*t.c*t.c+1,this.tx=-2*t.a*t.d,this.ty=-2*t.b*t.d,this.tz=-2*t.c*t.d},m.prototype.determinant=function(){return this.m11*(this.m22*this.m33-this.m23*this.m32)+this.m12*(this.m23*this.m31-this.m21*this.m33)+this.m13*(this.m21*this.m32-this.m22*this.m31)},m.prototype.inverse=function(){var t=this.determinant();assert(f(t)>1e-6);var i=1/t,s=new m;return s.m11=(this.m22*this.m33-this.m23*this.m32)*i,s.m12=(this.m13*this.m32-this.m12*this.m33)*i,s.m13=(this.m12*this.m23-this.m13*this.m22)*i,s.m21=(this.m23*this.m31-this.m21*this.m33)*i,s.m22=(this.m11*this.m33-this.m13*this.m31)*i,s.m23=(this.m13*this.m21-this.m11*this.m23)*i,s.m31=(this.m21*this.m32-this.m22*this.m31)*i,s.m32=(this.m12*this.m31-this.m11*this.m32)*i,s.m33=(this.m11*this.m22-this.m12*this.m21)*i,s.tx=-(this.tx*s.m11+this.ty*s.m21+this.tz*s.m31),s.ty=-(this.tx*s.m12+this.ty*s.m22+this.tz*s.m32),s.tz=-(this.tx*s.m13+this.ty*s.m23+this.tz*s.m33),s},m.prototype.getTranslation=function(){return new t(this.tx,this.ty,this.tz)},m.prototype.getPositionFromParentToLocalMatrix=function(){return new t(-(this.tx*this.m11+this.ty*this.m12+this.tz*this.m13),-(this.tx*this.m21+this.ty*this.m22+this.tz*this.m23),-(this.tx*this.m31+this.ty*this.m32+this.tz*this.m33))},m.prototype.getPositionFromLocalToParentMatrix=function(){return new t(this.tx,this.ty,this.tz)},m.multiply=function(i,s){return new t(i.x*s.m11+i.y*s.m21+i.z*s.m31+s.tx,i.x*s.m12+i.y*s.m22+i.z*s.m32+s.ty,i.x*s.m13+i.y*s.m23+i.z*s.m33+s.tz)},m.concat=function(t,i){return new m(t).concat(i)},m.prototype.concat=function(t){var i=this.m11,s=this.m12,h=this.m13,m=this.m21,n=this.m22,o=this.m23,e=this.m31,r=this.m32,y=this.m33,a=this.tx,u=this.ty,c=this.tz;return this.m11=i*t.m11+s*t.m21+h*t.m31,this.m12=i*t.m12+s*t.m22+h*t.m32,this.m13=i*t.m13+s*t.m23+h*t.m33,this.m21=m*t.m11+n*t.m21+o*t.m31,this.m22=m*t.m12+n*t.m22+o*t.m32,this.m23=m*t.m13+n*t.m23+o*t.m33,this.m31=e*t.m11+r*t.m21+y*t.m31,this.m32=e*t.m12+r*t.m22+y*t.m32,this.m33=e*t.m13+r*t.m23+y*t.m33,this.tx=a*t.m11+u*t.m21+c*t.m31+t.tx,this.ty=a*t.m12+u*t.m22+c*t.m32+t.ty,this.tz=a*t.m13+u*t.m23+c*t.m33+t.tz,this},this.Vector3=t,this.EulerAngles=i,this.Quaternion=s,this.RotationMatrix=h,this.Matrix4x3=m}).call(this);